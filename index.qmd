---
format:
  revealjs:
    incremental: false
    theme: [default, custom.scss]
execute: 
  echo: true
---

```{r}
#| label: setup
#| include: false
library(quarto)
library(babelquarto)
library(fs)
suppressPackageStartupMessages(library(tidyverse))
```

## babelquartoによるquartoウエブサイトの多言語化 {.theme-slide1 .line}

<br>

ニッタ ジョエル

<br>

::: {.medium}

<https://www.joelnitta.com>

`Japan.R2024`

:::

::: {.aside}

::: {.small}

Image: [Alexandre Debiève on Unsplash](https://unsplash.com/ja/%E5%86%99%E7%9C%9F/%E3%83%A9%E3%82%B8%E3%82%AA%E3%83%97%E3%83%AC%E3%83%BC%E3%83%A4%E3%83%BC%E3%83%AD%E3%83%83%E3%83%88-UmX-OgGODfM)

:::

:::

## 自己紹介：ニッタ ジョエル {.line}

- 千葉大学 准教授
- シダ植物の進化や生態学
- Rパッケージ開発（進化生態学系）

## Quarto はすごいぞ {.line}

:::: {.columns}

::: {.column width="40%"}
- QuartoはRやPythonの計算結果を直接文章に入れるツール
  - HTML（ウェブサイト、スライド、本）
  - PDF
  - MS Word
:::

::: {.column width="60%"}
![](https://rstudio.github.io/cheatsheets/html/images/quarto-illustration.png)
:::

::::

## Quarto の多言語機能がまだ出来ていない {.line}

:::: {.columns}

::: {.column width="50%"}
- しかし、Quartoは比較的新しいため、欠けている機能もあります。

- 備え付けで**多言語機能**がありません
:::

::: {.column width="50%"}
![](images/multi_lang_issue.png){width=90%}
:::

[<https://github.com/quarto-dev/quarto-cli/issues/275>]{.medsmall}

::::

## 注意 {.line}

- いつか多言語機能がQuartoに加わる可能性があります

- その場合、`babelquarto`は要らなくなるでしょう

- でも開発スクジュールが分かりませんので、多言語のニーズが今あれば使ってもいいと思います

## `babelquarto` {.line}

:::: {.columns}

::: {.column width="50%"}
- Quarto BookかWebsite**各言語**のバージョンを**レンダーする**

- 翻訳とは別

- Quartoのpluginではなく、Rパッケージ
:::

::: {.column width="50%"}
![](images/babelquarto_pagedown.png)
:::

::::

## 例：ソフトウェア・カーペントリー日本 {.medsmall}

<iframe src="https://swcarpentry-ja.github.io/" width="100%" height="500px"></iframe>

[<https://swcarpentry-ja.github.io/>]{.large}

# babelquarto demo {.line}

## 基本的なサイトを作る

```{r}
#| label: reset-example-site
#| echo: false
if (dir_exists("example")) {
  dir_delete("example")
}
```

:::: {.columns}

::: {.column width="50%" .medsmall}
```{r}
#| label: create-example-site
library(quarto)
quarto_create_project(
  name = "example",
  type = "website",
  no_prompt = TRUE,
  quiet = TRUE
)
```

:::

::: {.column width="50%" .medsmall}
```{r}
#| label: show-index
#| filename: "example/_quarto.yml"
#| eval: false
#| file: example/_quarto.yml
```
:::

::::

## 主言語を登録する

:::: {.columns}

::: {.column width="50%" .medsmall}
```{r}
#| label: add-lang
library(babelquarto)
register_main_language(
  main_language = "ja",
  project_path = "example"
)
```

:::

::: {.column width="50%" .medsmall}
```{r}
#| label: show-index-add-lang
#| filename: "example/_quarto.yml"
#| eval: false
#| file: example/_quarto.yml
```
:::

::::

## 翻訳言語を追加する

:::: {.columns}

::: {.column width="50%" .medsmall}
```{r}
#| label: add-second-lang
library(babelquarto)
register_further_languages(
  further_languages = c("en"),
  project_path = "example"
)
```

:::

::: {.column width="50%" .medsmall}
```{r}
#| label: show-index-add-second-lang
#| filename: "example/_quarto.yml"
#| eval: false
#| file: example/_quarto.yml
```
:::

::::

## `_quarto.yml`を編集する

:::: {.columns .medsmall}

::: {.column width="50%"}
```{r}
#| label: show-index-add-second-lang-show-again
#| code-line-numbers: "|5,24,26,29-30"
#| filename: "example/_quarto.yml"
#| eval: false
#| file: example/_quarto.yml
```
:::

::: {.column width="50%"}
```{r}
#| label: edit-qmd
#| include: false

fs::file_copy("example-quarto.yml", "example/_quarto.yml", overwrite = TRUE)
```

```{r}
#| label: show-index-after-edit
#| code-line-numbers: "|5,24,26,29-30"
#| filename: "example/_quarto.yml"
#| eval: false
#| file: example/_quarto.yml
```

:::

::::

## 翻訳ファイルを追加する

:::: {.columns}

::: {.column width="50%"}
```{r}
#| label: file-tree-orig
#| echo: false
dir_tree("example")
```

:::

::: {.column width="50%"}
```{r}
#| label: add-index-ja
#| include: false
fs::file_copy("example-index-ja.qmd", "example/index.qmd", overwrite = TRUE)
fs::file_copy("example-index-en.qmd", "example/index.en.qmd", overwrite = TRUE)
```

```{r}
#| label: file-tree-orig-after-add
#| echo: false
dir_tree("example")
```

:::

::::

---

:::: {.columns .medsmall}

::: {.column width="50%"}
```{r}
#| label: show-index-orig
#| filename: "example/index.qmd"
#| eval: false
#| file: example/index.qmd
```
:::

::: {.column width="50%"}
```{r}
#| label: show-index-ja
#| filename: "example/index.en.qmd"
#| eval: false
#| file: example/index.en.qmd
```

:::

::::

## レンダーする

注意：`quarto render`が使えません

`[WARNING] Could not load translations for ja data file translations/ja.yaml not found`を無視して良い

```{r}
#| label: render
render_website(project_path = "example")
```

## サーブする

注意：`quarto preview`が使えません

```{r}
#| label: serve
#| eval: false
servr::httw("example/_site")
```

---

<iframe src="https://joelnitta.github.io/example-babelquarto/" width="100%" height="500px"></iframe>

<https://joelnitta.github.io/example-babelquarto/>

## まとめ {.line}

- `_quarto.yml`に`babelquarto`フィルドを加える
- それぞれの`.qmd`ファイルの翻訳バージョンを加える
  - `index.en.qmd`
  - `about.en.qmd` など
- レンダーには`babelquarto::render_website()`を使う

## profiles

- Use for more complex setups

## github action

- modified from default, needs to install r packages

## what about translating content?

- chatgpt custom gpt

- babeldown integration with deepl

## what about keeping translation up to date?

- local gettext and PO files

- web based apps like crowdin

## take home message

- i18n enbles access and grows communities!
